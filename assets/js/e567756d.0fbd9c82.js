"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[2514],{18859(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"server/jenkins-oci","title":"Jenkins","description":"Jenkins agent related documentation","source":"@site/docs/server/jenkins.md","sourceDirName":"server","slug":"/server/jenkins-oci","permalink":"/site/docs/server/jenkins-oci","draft":false,"unlisted":false,"editUrl":"https://github.com/AdrianoRuseler/site/edit/main/docs/server/jenkins.md","tags":[],"version":"current","lastUpdatedBy":"Adriano Ruseler","lastUpdatedAt":1770311588000,"frontMatter":{"id":"jenkins-oci","title":"Jenkins","description":"Jenkins agent related documentation"},"sidebar":"tutorialSidebar","previous":{"title":"Apache","permalink":"/site/docs/server/apache-about"},"next":{"title":"Ubuntu","permalink":"/site/docs/server/ubuntu-oci"}}');var t=s(74848),i=s(28453);const o={id:"jenkins-oci",title:"Jenkins",description:"Jenkins agent related documentation"},a=void 0,d={},h=[{value:"Prepare the Remote Ubuntu Agent",id:"prepare-the-remote-ubuntu-agent",level:2},{value:"Install Java (OpenJDK 21)",id:"install-java-openjdk-21",level:3},{value:"Create a Dedicated Jenkins User",id:"create-a-dedicated-jenkins-user",level:3},{value:"Set Up SSH Access",id:"set-up-ssh-access",level:3},{value:"On your LOCAL machine (Controller) Generate and Inject SSH Keys",id:"on-your-local-machine-controller-generate-and-inject-ssh-keys",level:2},{value:"Remove jenkins user",id:"remove-jenkins-user",level:2},{value:"Configuration Reference",id:"configuration-reference",level:2},{value:"Host Key Verification Strategy",id:"host-key-verification-strategy",level:2}];function c(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"To get your Ubuntu remote agent ready for Jenkins, you'll need to run these commands on the remote machine (the agent) and one or two on your local machine (the controller)."}),"\n",(0,t.jsx)(n.h2,{id:"prepare-the-remote-ubuntu-agent",children:"Prepare the Remote Ubuntu Agent"}),"\n",(0,t.jsx)(n.h3,{id:"install-java-openjdk-21",children:"Install Java (OpenJDK 21)"}),"\n",(0,t.jsx)(n.p,{children:"Jenkins requires Java to run the agent .jar file. Match this to your Jenkins controller's version."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt update\r\nsudo apt install openjdk-21-jdk -y\r\n# Verify installation\r\njava -version\n"})}),"\n",(0,t.jsx)(n.p,{children:"Managing Multiple Versions"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo update-alternatives --config java\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-a-dedicated-jenkins-user",children:"Create a Dedicated Jenkins User"}),"\n",(0,t.jsx)(n.p,{children:"It is safer to run builds under a non-root user."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Create a system user named 'jenkins' with a home directory\r\nsudo adduser --system --group --home /home/jenkins jenkins\r\n\r\n# Create the workspace directory for Jenkins\r\nsudo mkdir -p /home/jenkins/agent\r\nsudo mkdir /home/jenkins/.ssh\r\nsudo touch /home/jenkins/.ssh/authorized_keys\r\nsudo chown -R jenkins:jenkins /home/jenkins\r\n\r\n# Run on the remote machine\r\nls -ld /home/jenkins/agent\r\n\r\n# Change the shell to bash for the jenkins user\r\nsudo chsh -s /bin/bash jenkins\n"})}),"\n",(0,t.jsx)(n.p,{children:'The "No Password" Way (Most Common for Jenkins)'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo visudo\n"})}),"\n",(0,t.jsx)(n.p,{children:"Add this line to the very bottom of the file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-txt",children:"jenkins ALL=(ALL) NOPASSWD: ALL\n"})}),"\n",(0,t.jsx)(n.h3,{id:"set-up-ssh-access",children:"Set Up SSH Access"}),"\n",(0,t.jsx)(n.p,{children:"You need to allow your local Jenkins controller to log into the remote agent without a password."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Open the SSH configuration file\r\nsudo nano /etc/ssh/sshd_config\r\n\r\nPubkeyAuthentication yes\r\nAuthorizedKeysFile .ssh/authorized_keys\r\n\r\nsudo systemctl restart ssh\n"})}),"\n",(0,t.jsx)(n.h2,{id:"on-your-local-machine-controller-generate-and-inject-ssh-keys",children:"On your LOCAL machine (Controller) Generate and Inject SSH Keys"}),"\n",(0,t.jsx)(n.p,{children:"Since Jenkins is in a container, the private key needs to be accessible to the Jenkins UI so it can pass it to the remote agent."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# 1. Generate keys on your host\r\nssh-keygen -t ed25519 -f ~/jenkins_agent_key\r\n\r\n# 2. Copy the public key to the remote agent\r\ncat ~/jenkins_agent_key.pub\r\nsudo nano /home/jenkins/.ssh/authorized_keys\r\n\r\n\r\n# 3. View the PRIVATE key (you will copy-paste this into Jenkins UI)\r\ncat ~/jenkins_agent_key\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Test the login manually\r\nssh -i ~/jenkins_agent_key jenkins@mdldocker.adrianoruseler.com\r\n\r\nssh -i ~/jenkins_agent_key jenkins@iot.adrianoruseler.com\r\n\r\nssh -i ~/jenkins_agent_key jenkins@moodleconf.ct.utfpr.edu.br\r\n\r\nssh -i ~/jenkins_agent_key jenkins@nupet.daelt.ct.utfpr.edu.br\r\n\r\nssh -i ~/jenkins_agent_key jenkins@mini.pc\r\n\r\nssh -i ~/jenkins_agent_key jenkins@docker.adrianoruseler.com\r\n\r\nssh -i ~/jenkins_agent_key jenkins@mysql.adrianoruseler.com\n"})}),"\n",(0,t.jsx)(n.h2,{id:"remove-jenkins-user",children:"Remove jenkins user"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Stop Jenkins Processes"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Kill any processes owned by the 'jenkins' user\r\nsudo pkill -u jenkins\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Delete the User"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Remove the user and their home directory (/home/jenkins)\r\nsudo deluser --remove-home jenkins\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Re-creating the User (The "Clean" Way)'}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# 1. Create the user with a standard home and bash shell\r\nsudo adduser jenkins --shell /bin/bash\r\n\r\n# 2. Create the agent workspace\r\nsudo mkdir -p /home/jenkins/agent\r\nsudo chown -R jenkins:jenkins /home/jenkins/agent\r\n\r\n# 3. Add your SSH key manually now while logged in as root\r\nsudo mkdir -p /home/jenkins/.ssh\r\n# Replace the string below with your actual public key\r\necho "ssh-ed25519 ..." | sudo tee /home/jenkins/.ssh/authorized_keys\r\nsudo chown -R jenkins:jenkins /home/jenkins/.ssh\r\nsudo chmod 700 /home/jenkins/.ssh\r\nsudo chmod 600 /home/jenkins/.ssh/authorized_keys\r\n\r\n# Add the Jenkins user to the Docker group (Recommended)\r\nsudo usermod -aG docker jenkins\n'})}),"\n",(0,t.jsx)(n.h2,{id:"configuration-reference",children:"Configuration Reference"}),"\n",(0,t.jsx)(n.p,{children:"When you go back to the Jenkins UI to add the node, use these paths based on the commands above:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Remote root directory: ",(0,t.jsx)(n.code,{children:"/home/jenkins/agent"})]}),"\n",(0,t.jsx)(n.li,{children:"Launch method: Launch agents via SSH"}),"\n",(0,t.jsx)(n.li,{children:"Host: [Your Remote IP]"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Credentials: Select the SSH Private Key you generated in Step 2."}),"\n",(0,t.jsx)(n.h2,{id:"host-key-verification-strategy",children:"Host Key Verification Strategy"}),"\n",(0,t.jsx)(n.p,{children:"Controls how Jenkins verifies the SSH key presented by the remote host whilst connecting."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Inside the Running Container (Direct)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If you don't want to hunt for volume paths, you can inject the key directly into the running container:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# 1. Enter the container as the jenkins user\r\ndocker exec -u jenkins -it <container_id_or_name> bash\r\n\r\n# 2. Create the directory and the file\r\nmkdir -p ~/.ssh\r\nssh-keyscan mysql.adrianoruseler.com >> ~/.ssh/known_hosts\r\nssh-keyscan moodleconf.ct.utfpr.edu.br >> ~/.ssh/known_hosts\r\nssh-keyscan docker.adrianoruseler.com >> ~/.ssh/known_hosts\r\nssh-keyscan iot.adrianoruseler.com >> ~/.ssh/known_hosts\r\nssh-keyscan mdldocker.adrianoruseler.com >> ~/.ssh/known_hosts\r\n\r\n# 3. Secure the permissions\r\nchmod 700 ~/.ssh\r\nchmod 644 ~/.ssh/known_hosts\n"})})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453(e,n,s){s.d(n,{R:()=>o,x:()=>a});var r=s(96540);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);